

#Область ПрограммныйИнтерфейс

#Область РедакторированиеЗаблокированныхРеквизитов

// Вызывается в формах объектов для разблокировки заблокированных реквизитов.
// 
// Параметры:
//     ЭтаФорма              - Форма объекта
//     ИмяФормыРазблокировки - Имя формы разблокировки
//     ОповещениеОРазблокировке - Описание оповещения после разблокировки
//
Процедура РазрешитьРедактированиеРеквизитовОбъекта(Форма, Знач ИмяФормыРазблокировки = "", ОповещениеОРазблокировке = Неопределено) Экспорт
	
	Если ЗначениеЗаполнено(Форма.Объект.Ссылка) Тогда
		
		Если Не ЗначениеЗаполнено(ИмяФормыРазблокировки) Тогда
			МассивИмениФормы = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивСлов(Форма.ИмяФормы, ".");
			МассивИмениФормы[3] = "РазблокированиеРеквизитов";
			ИмяФормыРазблокировки = СтрСоединить(МассивИмениФормы, ".");
		КонецЕсли;
		
		ДополнительныеПараметры = Новый Структура;
		ДополнительныеПараметры.Вставить("Форма",Форма);
		Если ОповещениеОРазблокировке <> Неопределено Тогда
			ДополнительныеПараметры.Вставить("ОповещениеОРазблокировке",ОповещениеОРазблокировке);
		КонецЕсли; 
		Оповещение = Новый ОписаниеОповещения("РазрешитьРедактированиеРеквизитовОбъектаЗавершение", ЭтотОбъект, ДополнительныеПараметры);
		
		ОткрытьФорму(ИмяФормыРазблокировки, 
		Новый Структура("Объект", Форма.Объект.Ссылка),
		,
		,
		,
		,
		Оповещение, 
		РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
		
	КонецЕсли;
	
КонецПроцедуры

// Служебная процедура.
//
Процедура РазрешитьРедактированиеРеквизитовОбъектаЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	Форма = ДополнительныеПараметры.Форма;
	Если Результат = Истина Тогда
		
		ЗаблокированныеРеквизиты = ЗапретРедактированияРеквизитовОбъектовКлиент.Реквизиты(Форма);
		ЗапретРедактированияРеквизитовОбъектовКлиент.УстановитьРазрешенностьРедактированияРеквизитов(Форма, ЗаблокированныеРеквизиты);
		ЗапретРедактированияРеквизитовОбъектовКлиент.УстановитьДоступностьЭлементовФормы(Форма);
		
	КонецЕсли;
	
	Если ДополнительныеПараметры.Свойство("ОповещениеОРазблокировке") Тогда
		
		ВыполнитьОбработкуОповещения(ДополнительныеПараметры.ОповещениеОРазблокировке, Результат);
		
	КонецЕсли; 
	
КонецПроцедуры

#КонецОбласти


#КонецОбласти 


#Область СлужебныеПиФ

Функция МаксимальныйЭлементМассива(МассивЧисел) Экспорт
	
	Если ТипЗнч(МассивЧисел) = Тип("Массив") И МассивЧисел.Количество() <> 0 Тогда
		
		ЭлементМассива = Новый Структура("Значение, Индекс"); 
		
		ИндексМаксимальногоЭлемента = -1;
		ЗначениеМаксимальногоЭлемента = -Pow(2, 31); // Значение, заведомо меньшее любого элемента в массиве.
		
		Для Индекс = 0 По МассивЧисел.Количество() - 1 Цикл
			Если МассивЧисел[Индекс] > ЗначениеМаксимальногоЭлемента Тогда
				ЗначениеМаксимальногоЭлемента = МассивЧисел[Индекс];
				ИндексМаксимальногоЭлемента = Индекс;
			КонецЕсли;
		КонецЦикла;
		
		ЭлементМассива.Значение = ЗначениеМаксимальногоЭлемента;
		ЭлементМассива.Индекс   = ИндексМаксимальногоЭлемента;
		
		Возврат ЭлементМассива;
		
	Иначе
		
		Возврат Неопределено;
		
	КонецЕсли;
	
КонецФункции

	
#КонецОбласти 


#Область ОбработкаСобытий

Процедура ПриНачалеРаботыСистемы() Экспорт
	
	Попытка
		
		ТекущийПользователь = ПользователиКлиентСервер.ТекущийПользователь();	
		
		КонтрагентАгента = РфпПолучениеДанныхСервер.ПолучитьКонтрагентаПользователяПортАгента(ТекущийПользователь); 
		
	Исключение
	    //ОписаниеОшибки()
	КонецПопытки; 
	
	
КонецПроцедуры
	
#КонецОбласти

Процедура Конец()
		
КонецПроцедуры
 

 
 