
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
	
	#Область ИнициализацияДаных
	
	// Инициализирует таблицы значений, содержащие данные табличных частей документа.
	// Таблицы значений сохраняет в свойствах структуры "ДополнительныеСвойства".
	//
	Процедура ИнициализироватьДанныеДокумента(ДокументСсылкаРНОтходы, СтруктураДополнительныеСвойства) Экспорт
		
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Номенклатура,
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Характеристика,
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Вес,
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Объем,
		|	&Период,
		|	&ВидДвижения,
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.ДатаСмены,
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.Смена,
		|	ВЫБОР
		|		КОГДА алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.алк_ВидыДокументаРН_Отходы.Реализация)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.алк_АналитикаЩепа.Реализация)
		|		ИНАЧЕ ВЫБОР
		|				КОГДА алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.алк_ВидыДокументаРН_Отходы.ПроизводствоПоддонов)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.алк_АналитикаЩепа.ПроизводствоПоддонов)
		|				ИНАЧЕ ВЫБОР
		|						КОГДА алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.алк_ВидыДокументаРН_Отходы.ПотреблениеКотельной)
		|							ТОГДА ЗНАЧЕНИЕ(Перечисление.алк_АналитикаЩепа.ПотреблениеКотельной)
		|						ИНАЧЕ ВЫБОР
		|								КОГДА алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.алк_ВидыДокументаРН_Отходы.ПотреблениеПрочее)
		|									ТОГДА ЗНАЧЕНИЕ(Перечисление.алк_АналитикаЩепа.ПотреблениеПрочее)
		|								ИНАЧЕ ВЫБОР
		|										КОГДА алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.алк_ВидыДокументаРН_Отходы.Утилизация)
		|											ТОГДА ЗНАЧЕНИЕ(Перечисление.алк_АналитикаЩепа.Утилизация)
		|										ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.алк_АналитикаЩепа.ПустаяСсылка)
		|									КОНЕЦ
		|							КОНЕЦ
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ КАК Аналитика,
		|	алк_РасходнаяНакладная_ОтходыЗапасы.ДополнительнаяАналитика
		|ИЗ
		|	Документ.алк_РасходнаяНакладная_Отходы.Запасы КАК алк_РасходнаяНакладная_ОтходыЗапасы
		|ГДЕ
		|	алк_РасходнаяНакладная_ОтходыЗапасы.Ссылка = &Ссылка";
		
		Запрос.УстановитьПараметр("Период", ДокументСсылкаРНОтходы.Дата);
		Запрос.УстановитьПараметр("Ссылка", ДокументСсылкаРНОтходы.Ссылка);
		Запрос.УстановитьПараметр("ВидДвижения", ВидДвиженияНакопления.Расход);
		//Запрос.УстановитьПараметр("Номенклатура", РфпПолучениеДанныхСервер.ОсновнаяНоменклатураКатегории(Справочники.КатегорииНоменклатуры.Щепа));
		
		МассивРезультатов = Запрос.ВыполнитьПакет();	
		
		СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаОтходы", МассивРезультатов[0].Выгрузить());
		
		
	КонецПроцедуры // ИнициализироватьДанныеДокумента()
	
	#КонецОбласти
	
		
	#Область ИнтерфейсПечати
	
	// Сформировать печатные формы объектов
	//
	// ВХОДЯЩИЕ:
	//   ИменаМакетов    - Строка    - Имена макетов, перечисленные через запятую
	//   МассивОбъектов  - Массив    - Массив ссылок на объекты которые нужно распечатать
	//   ПараметрыПечати - Структура - Структура дополнительных параметров печати
	//
	// ИСХОДЯЩИЕ:
	//   КоллекцияПечатныхФорм - Таблица значений - Сформированные табличные документы
	//   ПараметрыВывода       - Структура        - Параметры сформированных табличных документов
	//
	Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
		
		Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "РасходнаяНакладная") Тогда
			
			УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "РасходнаяНакладная", "Расходная накладная", ПечатнаяФорма(МассивОбъектов, ОбъектыПечати, "РасходнаяНакладная"));
			
		КонецЕсли;
		
	КонецПроцедуры
	
	// Сформировать печатные формы объектов
	//
	Функция ПечатнаяФорма(МассивОбъектов, ОбъектыПечати, ИмяМакета)
		
		Перем Ошибки;
		
		ТабличныйДокумент = Новый ТабличныйДокумент;
		
		ПервыйДокумент = Истина;
		
		
		Для Каждого ТекущийДокумент Из МассивОбъектов Цикл
			
			Если Не ПервыйДокумент Тогда
				ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
			КонецЕсли;
			ПервыйДокумент = Ложь;
			
			НомерСтрокиНачало = ТабличныйДокумент.ВысотаТаблицы + 1;
			
			Если ИмяМакета = "РасходнаяНакладная" Тогда
				
				СформироватьРасходнуюНакладную(ТабличныйДокумент, ТекущийДокумент);
				
			КонецЕсли;
			
		КонецЦикла;
		
		ОбщегоНазначенияКлиентСервер.СообщитьОшибкиПользователю(Ошибки);
		
		Возврат ТабличныйДокумент;
		
	КонецФункции // ПечатнаяФорма()
	
	// Заполняет список команд печати.
	// 
	// Параметры:
	//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати.
	//
	Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
		
		КомандаПечати = КомандыПечати.Добавить();
		КомандаПечати.Идентификатор = "РасходнаяНакладная";
		КомандаПечати.Представление = НСтр("ru = 'Расходная накладная'");
		КомандаПечати.ПроверкаПроведенияПередПечатью = Истина;
		КомандаПечати.Порядок = 1;	
		
	КонецПроцедуры
	
	// Процедура формирования Железнодорожной спецификации для пиломатериалов
	//
	Процедура СформироватьРасходнуюНакладную(ТабличныйДокумент, ТекущийДокумент)
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ТекущийДокумент", ТекущийДокумент);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.Ссылка КАК Ссылка,
		|	алк_ПеремещениеЛесопродукцииЗапасы.НомерСтроки,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Номенклатура,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Характеристика,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Количество КАК Количество,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Объем КАК Объем,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.Номер КАК Номер,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.Дата КАК ДатаДокумента,
		|	ПРЕДСТАВЛЕНИЕ(алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.ВидДокумента) КАК ВидОперации,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.Организация.Префикс КАК Префикс,
		|	ПРЕДСТАВЛЕНИЕ(алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
		|	алк_ПеремещениеЛесопродукцииЗапасы.Ссылка.Организация
		|ИЗ
		|	Документ.алк_ПеремещениеЛесопродукции.Запасы КАК алк_ПеремещениеЛесопродукцииЗапасы
		|ГДЕ
		|	алк_ПеремещениеЛесопродукцииЗапасы.Ссылка = &Ссылка
		|ИТОГИ
		|	СУММА(Количество),
		|	СУММА(Объем)
		|ПО
		|	Ссылка";
		
		Запрос.УстановитьПараметр("Ссылка", ТекущийДокумент.Ссылка);
		
		Макет = УправлениеПечатью.МакетПечатнойФормы("Документ.алк_ПеремещениеЛесопродукции.ПФ_MXL_Накладная");
		
		РезультатЗапроса = Запрос.Выполнить();  //  РезультатЗапроса.Выгрузить()
		
		ВыборкаСсылка = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		Пока ВыборкаСсылка.Следующий() Цикл
			
			ОбластьМакета = Макет.ПолучитьОбласть("Заголовок");
			
			НомерДокумента = ПечатьДокументовУНФ.ПолучитьНомерНаПечатьСУчетомДатыДокумента(ВыборкаСсылка.ДатаДокумента, ВыборкаСсылка.Номер, ВыборкаСсылка.Префикс);
			
			ОбластьМакета.Параметры.ТекстЗаголовка = "Расходная накладная № "
			+ НомерДокумента
			+ " от "
			+ Формат(ВыборкаСсылка.ДатаДокумента, "ДЛФ=DD");
			
			ОбластьМакета.Параметры.ВидОперации = ВыборкаСсылка.ВидОперации;
			
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ОбластьМакета = Макет.ПолучитьОбласть("Поставщик");
			
			СведенияОбОрганизации = УправлениеНебольшойФирмойСервер.СведенияОЮрФизЛице(ВыборкаСсылка.Организация, ВыборкаСсылка.ДатаДокумента, ,);
			ОбластьМакета.Параметры.ПредставлениеПоставщика = УправлениеНебольшойФирмойСервер.ОписаниеОрганизации(СведенияОбОрганизации, "ПолноеНаименование,ФактическийАдрес") +
			", " + ВыборкаСсылка.СтруктурнаяЕдиница;
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ОбластьМакета = Макет.ПолучитьОбласть("Покупатель");
			ОбластьМакета.Параметры.ПредставлениеПолучателя = "";
			
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ОбластьМакета = Макет.ПолучитьОбласть("ШапкаТаблицы");
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ВыборкаЗапасы = ВыборкаСсылка.Выбрать();
			ОбластьМакета = Макет.ПолучитьОбласть("Строка");
			
			Количество = 0;
			
			Пока ВыборкаЗапасы.Следующий() Цикл
				
				ОбластьМакета.Параметры.Заполнить(ВыборкаЗапасы);
				
				ТабличныйДокумент.Вывести(ОбластьМакета);
				
				Количество	= Количество + 1;
				
			КонецЦикла; 
			
			ОбластьМакета = Макет.ПолучитьОбласть("Итого");
			ОбластьМакета.Параметры.Заполнить(ВыборкаСсылка);
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ОбластьМакета = Макет.ПолучитьОбласть("ИтогиПрописью");
			ОбластьМакета.Параметры.ИтоговаяСтрока = "Всего наименований "
			+ Строка(Количество) + ", общее Количество " + Строка(ВыборкаСсылка.Количество) + " (" + УправлениеНебольшойФирмойСервер.КоличествоПрописью(ВыборкаСсылка.Количество) 
			+ "), общий Объем " + Строка(ВыборкаСсылка.Объем) + " (" + УправлениеНебольшойФирмойСервер.КоличествоПрописью(ВыборкаСсылка.Объем) + ")";
			
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ОбластьМакета = Макет.ПолучитьОбласть("ПодписьАкта");
			
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
			ОбластьМакета = Макет.ПолучитьОбласть("Подписи");
			
			ТабличныйДокумент.Вывести(ОбластьМакета);
			
		КонецЦикла; 
		
		
		
		
		
	КонецПроцедуры // СформироватьРасходнуюНакладную
	
	#КонецОбласти
	
	
#КонецЕсли

Процедура Конец()	
КонецПроцедуры
