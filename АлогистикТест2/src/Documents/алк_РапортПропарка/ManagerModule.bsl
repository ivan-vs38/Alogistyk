
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда 
	
	#Область ИнтерфейсПечати
	
	// Сформировать печатные формы объектов
	//
	// ВХОДЯЩИЕ:
	//   ИменаМакетов    - Строка    - Имена макетов, перечисленные через запятую
	//   МассивОбъектов  - Массив    - Массив ссылок на объекты которые нужно распечатать
	//   ПараметрыПечати - Структура - Структура дополнительных параметров печати
	//
	// ИСХОДЯЩИЕ:
	//   КоллекцияПечатныхФорм - Таблица значений - Сформированные табличные документы
	//   ПараметрыВывода       - Структура        - Параметры сформированных табличных документов
	//
	Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
				
		Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "алк_РапортПропаркаПечатнаяФорма") Тогда
			
			УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "алк_РапортПропаркаПечатнаяФорма", "Алк рапорт пропарка печатная форма", ПечатнаяФорма(МассивОбъектов, ОбъектыПечати, "алк_РапортПропаркаПечатнаяФорма"));
			
		КонецЕсли;
				
	КонецПроцедуры
	
	// Заполняет список команд печати.
	// 
	// Параметры:
	//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати.
	//
	Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
				
		КомандаПечати = КомандыПечати.Добавить();
		КомандаПечати.Идентификатор = "алк_РапортПропаркаПечатнаяФорма";
		КомандаПечати.Представление = НСтр("ru = 'Рапорт пропарка'");
		КомандаПечати.ПроверкаПроведенияПередПечатью = Истина;
		КомандаПечати.Порядок = 1;
		
	КонецПроцедуры
	
	// Сформировать печатные формы объектов
	//
	Функция ПечатнаяФорма(МассивОбъектов, ОбъектыПечати, ИмяМакета)
		
		Перем Ошибки;
		
		ТабличныйДокумент = Новый ТабличныйДокумент;
		
		ПервыйДокумент = Истина;
		
		
		Для Каждого ТекущийДокумент Из МассивОбъектов Цикл
			
			Если Не ПервыйДокумент Тогда
				ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
			КонецЕсли;
			ПервыйДокумент = Ложь;
			
			НомерСтрокиНачало = ТабличныйДокумент.ВысотаТаблицы + 1;
			
			Если ИмяМакета = "алк_РапортПропаркаПечатнаяФорма" Тогда
				
				СформироватьРапортПропарка(ТабличныйДокумент, ТекущийДокумент);
				
			КонецЕсли;
						
		КонецЦикла;
		
		ОбщегоНазначенияКлиентСервер.СообщитьОшибкиПользователю(Ошибки);
		
		Возврат ТабличныйДокумент;
		
	КонецФункции // ПечатнаяФорма()	
	
	Процедура СформироватьРапортПропарка(ТабличныйДокумент, ТекущийДокумент)
				
		Запрос = Новый Запрос;
		
		Запрос.Текст = "ВЫБРАТЬ
		               |	алк_РапортПропаркаКамеры.Ссылка,
		               |	СУММА(алк_РапортПропаркаКамеры.ОстатокНаНачалоСмены) КАК ИтогоОстатокНаНачалоСмены,
		               |	СУММА(алк_РапортПропаркаКамеры.РазгрузилиОбъем) КАК ИтогоРазгрузкаОбъем,
		               |	СУММА(алк_РапортПропаркаКамеры.ЗагрузкаОбъем) КАК ИтогоЗагрузкаОбъем,
		               |	СУММА(алк_РапортПропаркаКамеры.ОстатокНаКонецСмены) КАК ИтогоОстатокНаКонецСмены
		               |ПОМЕСТИТЬ ВТ_ИтогоОбъемПоДокументу
		               |ИЗ
		               |	Документ.алк_РапортПропарка.Камеры КАК алк_РапортПропаркаКамеры
		               |ГДЕ
		               |	алк_РапортПропаркаКамеры.Ссылка = &Ссылка
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	алк_РапортПропаркаКамеры.Ссылка
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	алк_РапортПропарка.Дата,
		               |	алк_РапортПропарка.Организация,
		               |	алк_РапортПропарка.СтруктурнаяЕдиница,
		               |	алк_РапортПропарка.Бригада,
		               |	алк_РапортПропарка.Участок,
		               |	алк_РапортПропаркаКамеры.НомерСтроки,
		               |	алк_РапортПропаркаКамеры.КамераСсылка,
		               |	алк_РапортПропаркаКамеры.ДлинаНаНачало,
		               |	алк_РапортПропаркаКамеры.ДлинаНаКонец,
		               |	алк_РапортПропаркаКамеры.ПородаНаНачало,
		               |	алк_РапортПропаркаКамеры.ПородаНаКонец,
		               |	алк_РапортПропаркаКамеры.СотрНаНачало КАК СортНаНачало,
		               |	алк_РапортПропаркаКамеры.СотрНаКонец КАК СортНаКонец,
		               |	алк_РапортПропаркаКамеры.ГрадацияНаНачало,
		               |	алк_РапортПропаркаКамеры.ГрадацияНаКонец,
		               |	алк_РапортПропаркаКамеры.СостояниеНаНачало,
		               |	алк_РапортПропаркаКамеры.СостояниеНаКонец,
		               |	алк_РапортПропаркаКамеры.ОстатокНаНачалоСмены,
		               |	алк_РапортПропаркаКамеры.НачалоРазгрузки КАК РазгрузкаНаНачало,
		               |	алк_РапортПропаркаКамеры.ОкончаниеРазгрузки КАК РазгрузкаНаОкончание,
		               |	алк_РапортПропаркаКамеры.РазгрузилиОбъем КАК РазгрузкаОбъем,
		               |	алк_РапортПропаркаКамеры.НачалоЗагрузки КАК ЗагрузкаНаНачало,
		               |	алк_РапортПропаркаКамеры.ОкончаниеЗазрузки КАК ЗагрузкаНаОкончание,
		               |	алк_РапортПропаркаКамеры.ЗагрузкаОбъем,
		               |	алк_РапортПропаркаКамеры.НачалоПропарки КАК ПропаркаНаНачало,
		               |	алк_РапортПропаркаКамеры.ОкончаниеПропарки КАК ПропаркаНаОкончание,
		               |	алк_РапортПропаркаКамеры.ОкончаниеПропаркиПлан КАК ПропаркаНормативное,
		               |	алк_РапортПропаркаКамеры.ОкончаниеПропаркиПланНаСледующуюСмену КАК ПропаркаНормативСледСмены,
		               |	алк_РапортПропаркаКамеры.ОстатокНаКонецСмены,
		               |	алк_РапортПропарка.Пропарщик,
		               |	алк_РапортПропарка.Мастер,
		               |	ВТ_ИтогоОбъемПоДокументу.ИтогоОстатокНаНачалоСмены,
		               |	ВТ_ИтогоОбъемПоДокументу.ИтогоРазгрузкаОбъем,
		               |	ВТ_ИтогоОбъемПоДокументу.ИтогоЗагрузкаОбъем,
		               |	ВТ_ИтогоОбъемПоДокументу.ИтогоОстатокНаКонецСмены
		               |ИЗ
		               |	Документ.алк_РапортПропарка КАК алк_РапортПропарка
		               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.алк_РапортПропарка.Камеры КАК алк_РапортПропаркаКамеры
		               |		ПО алк_РапортПропарка.Ссылка = алк_РапортПропаркаКамеры.Ссылка
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ИтогоОбъемПоДокументу КАК ВТ_ИтогоОбъемПоДокументу
		               |		ПО алк_РапортПропарка.Ссылка = ВТ_ИтогоОбъемПоДокументу.Ссылка
		               |ГДЕ
		               |	алк_РапортПропарка.Ссылка = &Ссылка";
		
		Запрос.УстановитьПараметр("Ссылка",ТекущийДокумент);
		
		ТЗ = Запрос.Выполнить().Выгрузить();
		
		ТабличныйДокумент = Новый ТабличныйДокумент;
		
		Макет = ПолучитьМакет("алк_РапортПропаркаПечатнаяФорма"); 
		
		//выводим заголовок
		ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок"); 
		
		ТабличныйДокумент.Вывести(ОбластьЗаголовок); 
		//\\
		
		//заполняем шапку рапорта
		ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
		
		ОбластьШапка.Параметры.Заполнить(ТЗ[0]);
				
		ТабличныйДокумент.Вывести(ОбластьШапка); 
		//\\   
		
		//выводим разделитель (пустые поля)
		ОбластьРазделитель = Макет.ПолучитьОбласть("Разделитель"); 
		
		ТабличныйДокумент.Вывести(ОбластьРазделитель); 
		//\\
		
		//выводим шапку таблицы рапорта
		ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы"); 
		
		ТабличныйДокумент.Вывести(ОбластьШапкаТаблицы); 
		//\\
		
		//заполняем ТЧ рапорта
		ОбластьТЧСПараметрами = Макет.ПолучитьОбласть("ТЧСПараметрами");
		
		Для Каждого эл ИЗ ТЗ Цикл 
			
			ОбластьТЧСПараметрами.Параметры.Заполнить(эл);
			 
			ТабличныйДокумент.Вывести(ОбластьТЧСПараметрами); 
			
		КонецЦикла;
		//\\
		
		//выводим итого по рапорту
		ОбластьИТОГОТаблицы = Макет.ПолучитьОбласть("ТЧИтог");
		
		ОбластьИТОГОТаблицы.Параметры.Заполнить(ТЗ[0]);
		
		ТабличныйДокумент.Вывести(ОбластьИТОГОТаблицы); 
		//\\
		
		//выводим разделитель (пустые поля)
		ОбластьРазделитель = Макет.ПолучитьОбласть("Разделитель"); 
		
		ТабличныйДокумент.Вывести(ОбластьРазделитель); 
		//\\

		
		//заполняем подвал рапорта
		ОбластьПодвал = Макет.ПолучитьОбласть("Подвал"); 
		
		ОбластьПодвал.Параметры.Заполнить(ТЗ[0]);
				
		ТабличныйДокумент.Вывести(ОбластьПодвал); 
		//\\  
		
		//устанавливаем ориентацию и масштаб
		ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт; 
		
		ТабличныйДокумент.АвтоМасштаб = Истина;
		//\\

		
	КонецПроцедуры  // СформироватьРапортПропарка()	
	
		
	#КонецОбласти

	
	#Область ИнициализацияДаных
	
	// Инициализирует таблицы значений, содержащие данные табличных частей документа.
	// Таблицы значений сохраняет в свойствах структуры "ДополнительныеСвойства".
	//
	Процедура ИнициализироватьДанныеДокумента(ДокументСсылкаВыгрузкаИзКамерыПропарки, СтруктураДополнительныеСвойства) Экспорт
		
		ТекстЗапроса = ТекстЗапросаДанныеДокумента();     
			
		Запрос = Новый Запрос;
		Запрос.Текст = ТекстЗапроса;
		Запрос.УстановитьПараметр("Ссылка", ДокументСсылкаВыгрузкаИзКамерыПропарки);
		Запрос.УстановитьПараметр("ВидДвиженияПриход", ВидДвиженияНакопления.Приход);
		Запрос.УстановитьПараметр("ВидДвиженияРасход", ВидДвиженияНакопления.Расход);
		         		
		МассивРезультатовЗапроса = Запрос.ВыполнитьПакет();
		
		СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаОстаткиКамерыГТО", МассивРезультатовЗапроса[0].Выгрузить());  
		СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаВремяПропарки", МассивРезультатовЗапроса[1].Выгрузить());

		
	КонецПроцедуры

	#КонецОбласти
	
	
		
	#Область СервисныеПроцедурыИФункции
	
	
		
	Функция ТекстЗапросаДанныеДокумента()
		
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоЗагрузки = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ВЫБОР
		|					КОГДА алк_РапортПропаркаКамеры.Ссылка.Смена = ЗНАЧЕНИЕ(Перечисление.Смены.смена_8_20)
		|						ТОГДА ДОБАВИТЬКДАТЕ(алк_РапортПропаркаКамеры.Ссылка.ДатаСмены, ЧАС, 8)
		|					ИНАЧЕ ДОБАВИТЬКДАТЕ(алк_РапортПропаркаКамеры.Ссылка.ДатаСмены, ЧАС, 20)
		|				КОНЕЦ
		|		ИНАЧЕ алк_РапортПропаркаКамеры.НачалоЗагрузки
		|	КОНЕЦ КАК Период,
		|	алк_РапортПропаркаКамеры.Ссылка КАК Регистратор,
		|	алк_РапортПропаркаКамеры.Ссылка.СтруктурнаяЕдиница,
		|	алк_РапортПропаркаКамеры.КамераСсылка КАК КамераПропарки,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки > алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.ПородаНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.ПородаНаКонец
		|	КОНЕЦ КАК Порода,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки > алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.ДлинаНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.ДлинаНаКонец
		|	КОНЕЦ КАК Длина,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки > алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.СотрНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.СотрНаКонец
		|	КОНЕЦ КАК Сотр,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки > алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.ГрадацияНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.ГрадацияНаКонец
		|	КОНЕЦ КАК Градация,
		|	алк_РапортПропаркаКамеры.ЗагрузкаОбъем КАК Количество,
		|	&ВидДвиженияПриход КАК ВидДвижения
		|ИЗ
		|	Документ.алк_РапортПропарка.Камеры КАК алк_РапортПропаркаКамеры
		|ГДЕ
		|	алк_РапортПропаркаКамеры.Ссылка = &Ссылка
		|	И алк_РапортПропаркаКамеры.ЗагрузкаОбъем > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ВЫБОР
		|					КОГДА алк_РапортПропаркаКамеры.Ссылка.Смена = ЗНАЧЕНИЕ(Перечисление.Смены.смена_8_20)
		|						ТОГДА ДОБАВИТЬКДАТЕ(алк_РапортПропаркаКамеры.Ссылка.ДатаСмены, ЧАС, 8)
		|					ИНАЧЕ ДОБАВИТЬКДАТЕ(алк_РапортПропаркаКамеры.Ссылка.ДатаСмены, ЧАС, 20)
		|				КОНЕЦ
		|		ИНАЧЕ алк_РапортПропаркаКамеры.НачалоРазгрузки
		|	КОНЕЦ,
		|	алк_РапортПропаркаКамеры.Ссылка,
		|	алк_РапортПропаркаКамеры.Ссылка.СтруктурнаяЕдиница,
		|	алк_РапортПропаркаКамеры.КамераСсылка,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки < алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.ПородаНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.ПородаНаКонец
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки < алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.ДлинаНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.ДлинаНаКонец
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки < алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.СотрНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.СотрНаКонец
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА алк_РапортПропаркаКамеры.НачалоРазгрузки < алк_РапортПропаркаКамеры.НачалоЗагрузки
		|			ТОГДА алк_РапортПропаркаКамеры.ГрадацияНаНачало
		|		ИНАЧЕ алк_РапортПропаркаКамеры.ГрадацияНаКонец
		|	КОНЕЦ,
		|	алк_РапортПропаркаКамеры.РазгрузилиОбъем,
		|	&ВидДвиженияРасход
		|ИЗ
		|	Документ.алк_РапортПропарка.Камеры КАК алк_РапортПропаркаКамеры
		|ГДЕ
		|	алк_РапортПропаркаКамеры.Ссылка = &Ссылка
		|	И алк_РапортПропаркаКамеры.РазгрузилиОбъем > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	алк_РапортПропаркаТаблицаДляДвижений.Ссылка.ДатаСмены КАК Период,
		|	алк_РапортПропаркаТаблицаДляДвижений.Ссылка КАК Регистратор,
		|	алк_РапортПропаркаТаблицаДляДвижений.НомерСтроки,
		|	алк_РапортПропаркаТаблицаДляДвижений.Камера КАК КамераПропарки,
		|	алк_РапортПропаркаТаблицаДляДвижений.Состояние,
		|	алк_РапортПропаркаТаблицаДляДвижений.План,
		|	алк_РапортПропаркаТаблицаДляДвижений.ВремяНачала,
		|	алк_РапортПропаркаТаблицаДляДвижений.ВремяОкончания
		|ИЗ
		|	Документ.алк_РапортПропарка.ТаблицаДляДвижений КАК алк_РапортПропаркаТаблицаДляДвижений
		|ГДЕ
		|	алк_РапортПропаркаТаблицаДляДвижений.Ссылка = &Ссылка";
		
		Возврат ТекстЗапроса;
		
	КонецФункции


	
	
	Функция ТекстЗапросаДанныеДокумента0()
		
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	алк_РапортПропаркаКамеры.Ссылка.Дата КАК Период,
		|	алк_РапортПропаркаКамеры.Ссылка.Организация,
		|	алк_РапортПропаркаКамеры.Ссылка.СтруктурнаяЕдиница,
		|	алк_РапортПропаркаКамеры.КамераПропарки КАК Ячейка,
		|	алк_РапортПропаркаКамеры.Операция,
		|	алк_РапортПропаркаКамеры.ГрадацияПропарки,
		|	РАЗНОСТЬДАТ(алк_РапортПропаркаКамеры.НачалоОперации, алк_РапортПропаркаКамеры.ОкончаниеОперации, СЕКУНДА) КАК ВремяОперации
		|ИЗ
		|	Документ.алк_РапортПропарка.Камеры КАК алк_РапортПропаркаКамеры";
		
		Возврат ТекстЗапроса;
		
	КонецФункции
	
	#КонецОбласти

	
	
#КонецЕсли
