

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// СтандартныеПодсистемы.Печать
	УправлениеПечатью.ПриСозданииНаСервере(ЭтотОбъект, Элементы.ПодменюПечать);
	// Конец СтандартныеПодсистемы.Печать
	УправлениеНебольшойФирмойСервер.УстановитьОтображаниеПодменюПечати(Элементы.ПодменюПечать);
	
	Если Параметры.Ключ.Пустая() И ПараметрыСеанса.алк_СеансПортовогоАгента Тогда
		
		Объект.КонтрагентЭкспедитор = ПараметрыСеанса.алк_КонтрагентПортовогоАгента;
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти 


#Область ОбработчикиСобытийЭлементоФормы

&НаКлиенте
Процедура ПартииДокументПартииПриИзменении(Элемент)
	
	ТекДанные = Элементы.Партии.ТекущиеДанные;
	Если ТекДанные <> Неопределено Тогда
		
		ДокПартии = ТекДанные.ДокументПартии;
		
	КонецЕсли; 
	
	ПартииДокументПартииПриИзмененииНаСервере(ДокПартии);
	
КонецПроцедуры

&НаСервере
Процедура ПартииДокументПартииПриИзмененииНаСервере(Партия)
	
	
	
КонецПроцедуры

&НаКлиенте
Процедура ЗапасыПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Отказ = Истина;
	
КонецПроцедуры


#КонецОбласти 


#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ЗаполнитьПоДокументуОснованию()
	
	Если НЕ ЗначениеЗаполнено(Объект.ДокументОснование) Тогда
		
		Возврат;
		
	КонецЕсли;
	
	ТекстВопроса = НСтр("ru = 'Документ будет полностью перезаполнен по ""Основанию"".
	|Продолжить выполнение операции?'");
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ЗаполнитьПоДокументуОснованиюЗавершение", ЭтотОбъект);
	
	ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ДаНет);
	
КонецПроцедуры // ЗаполнитьПоДокументуОснованию()

&НаСервере
Процедура ЗаполнитьПоДокументу()
	
	Документ = РеквизитФормыВЗначение("Объект");
	Документ.Заполнить(Новый Структура("ЗаполнитьПоДокументамОснованиям", Истина));
	ЗначениеВРеквизитФормы(Документ, "Объект");
	Модифицированность = Истина;
	
КонецПроцедуры // ЗаполнитьПоДокументу()

&НаСервере
Процедура ЗаполнитьЗапасыНаСервере()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	алк_ТранспортировкаЗапасовЗапасы.Ссылка,
	|	алк_ТранспортировкаЗапасовЗапасы.НомерСтроки,
	|	алк_ТранспортировкаЗапасовЗапасы.Номенклатура,
	|	алк_ТранспортировкаЗапасовЗапасы.Характеристика,
	//|	алк_ТранспортировкаЗапасовЗапасы.Идентифицирован,
	|	алк_ТранспортировкаЗапасовЗапасы.НомерСерии,
	|	алк_ТранспортировкаЗапасовЗапасы.СерийныйНомер,
	|	алк_ТранспортировкаЗапасовЗапасы.КоличествоПакетов,
	|	алк_ТранспортировкаЗапасовЗапасы.Объем,
	|	алк_ТранспортировкаЗапасовЗапасы.ОбъемТаможня,
	|	алк_ТранспортировкаЗапасовЗапасы.КоличествоСостав,
	|	алк_ТранспортировкаЗапасовЗапасы.ВесНетто,
	|	алк_ТранспортировкаЗапасовЗапасы.ВесБрутто
	|ИЗ
	|	Документ.алк_ТранспортировкаЗапасов.Запасы КАК алк_ТранспортировкаЗапасовЗапасы
	|ГДЕ
	|	алк_ТранспортировкаЗапасовЗапасы.Ссылка В (&спСсылка)";
	
	Запрос.УстановитьПараметр("спСсылка", Объект.Партии.Выгрузить(, "ДокументПартии"));
	
	РезультатЗапроса = Запрос.Выполнить(); //  РезультатЗапроса.Выгрузить()
	
	Объект.Запасы.Загрузить(РезультатЗапроса.Выгрузить());
	
КонецПроцедуры

#КонецОбласти


#Область ОбработкаКоманд

&НаКлиенте
Процедура ЗаполнитьПоОснованию(Команда)
	
	ЗаполнитьПоДокументуОснованию();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьЗапасы(Команда)
	
	ОписаниеКоманды = Новый Структура("Представление");
	ОписаниеКоманды.Представление = "Заполнение запасов";
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ОписаниеКоманды", ОписаниеКоманды);
	
	
	Если Объект.Ссылка.Пустая() Тогда
		
		ТекстВопроса = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
		НСтр("ru = 'Данные еще не записаны.
		|Выполнение действия ""%1"" возможно только после записи данных.
		|Данные будут записаны.'"),
		ОписаниеКоманды.Представление);
		
		ОписаниеОповещения = Новый ОписаниеОповещения("ВыполнитьПодтверждениеЗаписи", ЭтотОбъект, ДополнительныеПараметры);
		ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ОКОтмена);
		Возврат;
		
	Иначе
		
		ЗаполнитьЗапасыНаСервере();
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти 


#Область ОбработчикиРезультатовИнтерактивныхДействий

&НаКлиенте
Процедура ЗаполнитьПоДокументуОснованиюЗавершение(РезультатЗакрытия, ДополнительныеПараметры) Экспорт
	
	Если РезультатЗакрытия = КодВозвратаДиалога.Да Тогда
		
		ЗаполнитьПоДокументу();
		
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьПоДокументуОснованиюЗавершение()

// Продолжение процедуры ВыполнитьПодтверждениеЗаписи.
&НаКлиенте
Процедура ВыполнитьПодтверждениеЗаписи(РезультатВопроса, ДополнительныеПараметры) Экспорт
	
	ОписаниеКоманды = ДополнительныеПараметры.ОписаниеКоманды;
	
	Если РезультатВопроса = КодВозвратаДиалога.ОК Тогда
		ОчиститьСообщения();
		ЭтаФорма.Записать();
		Если Объект.Ссылка.Пустая() Или ЭтаФорма.Модифицированность Тогда
			Возврат; // Запись не удалась, сообщения о причинах выводит платформа.
		КонецЕсли;
	ИначеЕсли РезультатВопроса = КодВозвратаДиалога.Отмена Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьЗапасыНаСервере();
	
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиБиблиотек

// СтандартныеПодсистемы.Печать
&НаКлиенте
Процедура Подключаемый_ВыполнитьКомандуПечати(Команда)
	
	УправлениеПечатьюКлиент.ВыполнитьПодключаемуюКомандуПечати(Команда, ЭтотОбъект, Объект);
	// УНФ
	СтатистикаИспользованияФормКлиент.ДобавитьСтатистикуКомандПечати(ЭтотОбъект, Команда);
	// Конец УНФ
	
КонецПроцедуры
// Конец СтандартныеПодсистемы.Печать


#КонецОбласти 


Процедура Конец()		
КонецПроцедуры




